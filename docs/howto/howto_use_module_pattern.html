<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Use module pattern · ZIO</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="## How to structure larger ZIO programs?"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Use module pattern · ZIO"/><meta property="og:type" content="website"/><meta property="og:url" content="https://zio.dev/"/><meta property="og:description" content="## How to structure larger ZIO programs?"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="https://unpkg.com/vanilla-back-to-top@7.1.14/dist/vanilla-back-to-top.min.js"></script><script>
        document.addEventListener('DOMContentLoaded', function() {
          addBackToTop(
            {"zIndex":100,"cornerOffset":100}
          )
        });
        </script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/navbar_brand.png" alt="ZIO"/><h2 class="headerTitleWithLogo">ZIO</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/overview/overview_index" target="_self">Overview</a></li><li class=""><a href="/docs/datatypes/datatypes_index" target="_self">Data Types</a></li><li class=""><a href="/docs/interop/interop_index" target="_self">Interop</a></li><li class=""><a href="/docs/usecases/usecases_index" target="_self">Use Cases</a></li><li class="siteNavGroupActive"><a href="/docs/howto/howto_index" target="_self">How to</a></li><li class=""><a href="/docs/resources/resources" target="_self">Resources</a></li><li class=""><a href="/docs/ecosystem/ecosystem" target="_self">Ecosystem</a></li><li class=""><a href="/docs/about/about_index" target="_self">About</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>How to</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">How to</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/howto/howto_index">Summary</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/howto/howto_use_module_pattern">Use module pattern</a></li><li class="navListItem"><a class="navItem" href="/docs/howto/howto_test_effects">Test effects</a></li><li class="navListItem"><a class="navItem" href="/docs/howto/howto_mock_services">Mock services</a></li><li class="navListItem"><a class="navItem" href="/docs/howto/howto_handle_errors">Handle errors</a></li><li class="navListItem"><a class="navItem" href="/docs/howto/howto_access_system_information">Access system information</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Use module pattern</h1></header><article><div><span><h2><a class="anchor" aria-hidden="true" id="how-to-structure-larger-zio-programs"></a><a href="#how-to-structure-larger-zio-programs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>How to structure larger ZIO programs?</h2>
<p>ZIO was designed around composability. Larger problems can - and should be - split into smaller ones, each piece having well defined boundaries and
tested in isolation. Smaller programs can then be composed together to form larger ones and the correctness of each piece implies the correctness of
whole application.</p>
<p>ZIO lets you wrap any arbitrary piece of code and lift it into its effect system, giving you much flexibility around how you structure your program.
However, as any powerful tool, it may be misused, therefore we recommend you make yourself familiar with &quot;Environmental effects&quot; and &quot;Module pattern&quot;.</p>
<h2><a class="anchor" aria-hidden="true" id="hidden-inputs"></a><a href="#hidden-inputs" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hidden inputs</h2>
<p>Functions often need some context to perform their duties. For example, let's take a simple method that connects to database. It might look like:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> scala.concurrent.<span class="hljs-type">Future</span>

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">connect</span></span>(host: <span class="hljs-type">String</span>, port: <span class="hljs-type">Int</span>): <span class="hljs-type">Future</span>[<span class="hljs-type">Connection</span>] = ???
</code></pre>
<p>The signature of the method <code>(String, Int) =&gt; Future[Connection]</code> tells the whole story about what it can and cannot do. Obviously it uses <code>Future</code>
so it will suffer all of its limitations, but there is nothing wrong with it. However, as your application grows and you start to group methods that
are conceptually tightly related, you may end up with something like this:</p>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Database</span>(<span class="hljs-params">config: <span class="hljs-type">DatabaseConfig</span></span>) </span>{

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">connect</span></span>(): <span class="hljs-type">Future</span>[<span class="hljs-type">Connection</span>] = ???
}
</code></pre>
<p>Since you don't want to thread <em>host</em> and <em>port</em> parameters throughout your entire application you've moved them to <code>DatabaseConfig</code> and you require
it to be present upon creation of <code>Database</code> module. The connect method signature has now changed to <code>() =&gt; Future[Unit]</code> which tells a lie about what
this method needs to run, as it does access a hidden channel of inputs - the <code>this</code> of <code>Database</code> instance.</p>
<p>With ZIO we can use the environment to provide our function with additional context it needs to run.</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> zio._

<span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Database</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">connect</span></span>(): <span class="hljs-type">ZIO</span>[<span class="hljs-type">DatabaseConfig</span>, <span class="hljs-type">Unit</span>, <span class="hljs-type">Connection</span>]
}
</code></pre>
<p>We've removed the hidden input by pulling the required context into the environment type. Now the type signature tells exactly what this effect can (or
cannot) do.</p>
<h2><a class="anchor" aria-hidden="true" id="environmental-effects"></a><a href="#environmental-effects" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Environmental effects</h2>
<p>The ZIO data type has an <code>R</code> type parameter, which is used to describe the type of <em>environment</em> required by the effect. We will reference to the <code>R</code>
type as the environment from now on. This opens up another channel for typed inputs to our function which we can leverage to pass on any additional
context our function requires.</p>
<p>The <em>environmental effects</em> is a pattern where you store your effects in the environment so they can be accessed by other effects.</p>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">UserRepository</span> </span>{

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">find</span></span>(id: <span class="hljs-type">UserId</span>): <span class="hljs-type">ZIO</span>[<span class="hljs-type">Database</span> <span class="hljs-keyword">with</span> <span class="hljs-type">DatabaseConfig</span>, <span class="hljs-type">Unit</span>, <span class="hljs-type">Option</span>[<span class="hljs-type">User</span>]] =
   <span class="hljs-keyword">for</span> {
     db   &lt;- <span class="hljs-type">ZIO</span>.environment[<span class="hljs-type">Database</span>]
     conn &lt;- db.connect
     <span class="hljs-comment">// ...</span>
   } <span class="hljs-keyword">yield</span> ???
}
</code></pre>
<p>In this example we're accessing the environment to retrieve the <code>Database</code> service, from which we run the effect <code>connect</code> to retrieve a connection.</p>
<blockquote>
<p><strong>Note:</strong> even if we did not explicitly typed <code>find</code> method, the compiler would infer the correct <code>R</code> type to be <code>Database with DatabaseConfig</code>.</p>
</blockquote>
<h2><a class="anchor" aria-hidden="true" id="module-pattern"></a><a href="#module-pattern" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Module pattern</h2>
<p>We've discussed how to create effects and how the environment can be used to access them. Now you will learn how to structure your application into
inter-dependent modules. First we will define a <code>Postman</code> service, which exposes a single capability - to deliver email messages.</p>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Postman</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">postman</span></span>: <span class="hljs-type">Postman</span>.<span class="hljs-type">Service</span>[<span class="hljs-type">Any</span>]
}

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Postman</span> </span>{
  <span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Service</span>[<span class="hljs-type">R</span>] </span>{
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">deliver</span></span>(email: <span class="hljs-type">Email</span>): <span class="hljs-type">ZIO</span>[<span class="hljs-type">R</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">DeliveryStatus</span>]
  }
}
</code></pre>
<p>The <code>Postman</code> trait is the <em>module</em>, which is just a container for the <code>Postman.Service</code>.</p>
<blockquote>
<p><strong>Note:</strong> By convention we name the value holding the reference to the service the same as module, only with first letter lower-cased.
This is to avoid name collisions when mixing multiple modules to create the environment.</p>
</blockquote>
<p>The <em>service</em> is just an ordinary interface, defining the <em>capabilities</em> it provides.</p>
<blockquote>
<p><strong>Note:</strong> By convention we place the <em>service</em> inside the companion object of the <em>module</em> and name it <code>Service</code>.
This is to have a consistent naming scheme <code>&lt;Module&gt;.Service[R]</code> across the entire application.
It is also the structure required by some macros in <a href="https://github.com/zio/zio-macros">zio-macros</a> project.</p>
</blockquote>
<p>The <em>capability</em> is a method or value defined by the <em>service</em>. While these may be ordinary functions, if you want all the benefits ZIO provides,
these should all be ZIO effects.</p>
<h2><a class="anchor" aria-hidden="true" id="dependency-injection"></a><a href="#dependency-injection" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Dependency injection</h2>
<p>There are many approaches to dependency injection and they divide into two categories. The dependency graph is either resolved at compile time (and the
requirements expressed using the type system, like in <a href="http://jonasboner.com/real-world-scala-dependency-injection-di/">cake pattern</a>) or at runtime (and the requirements passed via constructor
like in <a href="https://izumi.7mind.io/latest/release/doc/distage/">distage</a>).</p>
<p>They all lie somewhere on the spectrum between manual (explicit) and automatic (aka <em>magical</em>) wiring. As programmers we want to get rid of as much
boilerplate as possible, while also keeping the solution simple and flexible.</p>
<p>Let's define another module that will depend on <code>Postman</code>.</p>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Newsletter</span> </span>{
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">newsletter</span></span>: <span class="hljs-type">Newsletter</span>.<span class="hljs-type">Service</span>[<span class="hljs-type">Any</span>]
}

<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Newsletter</span> </span>{
  <span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">Service</span>[<span class="hljs-type">R</span>] </span>{
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send</span></span>(id: <span class="hljs-type">TemplateId</span>, recipients: <span class="hljs-type">List</span>[<span class="hljs-type">EmailAddress</span>]): <span class="hljs-type">ZIO</span>[<span class="hljs-type">R</span>, <span class="hljs-type">Nothing</span>, <span class="hljs-type">Unit</span>]
  }
}
</code></pre>
<p>With <em>module pattern</em> specifying dependencies is as simple as:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">import</span> zio.stream._

<span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">NewsletterLive</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Newsletter</span> </span>{

  <span class="hljs-comment">// dependencies</span>
  <span class="hljs-keyword">val</span> emailRenderer: <span class="hljs-type">EmailRenderer</span>.<span class="hljs-type">Service</span>[<span class="hljs-type">Any</span>]
  <span class="hljs-keyword">val</span> postman: <span class="hljs-type">Postman</span>.<span class="hljs-type">Service</span>[<span class="hljs-type">Any</span>]

  <span class="hljs-keyword">final</span> <span class="hljs-keyword">val</span> newsletter = <span class="hljs-keyword">new</span> <span class="hljs-type">Newsletter</span>.<span class="hljs-type">Service</span>[<span class="hljs-type">Any</span>] {

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send</span></span>(id: <span class="hljs-type">TemplateId</span>, recipients: <span class="hljs-type">List</span>[<span class="hljs-type">EmailAddress</span>]): <span class="hljs-type">UIO</span>[<span class="hljs-type">Unit</span>] =
      <span class="hljs-type">ZStream</span>
        .fromIterable(recipients)
        .mapM { emailAddress =&gt;
          <span class="hljs-keyword">for</span> {
            email          &lt;- emailRenderer.render(id, emailAddress)
            deliveryStatus &lt;- postman.deliver(email)
          } <span class="hljs-keyword">yield</span> deliveryStatus
        }
        .run(<span class="hljs-type">Sink</span>.ignoreWhile[<span class="hljs-type">DeliveryStatus</span>](_ =&gt; <span class="hljs-literal">true</span>))
  }
}
</code></pre>
<p>In this example, the dependency on <code>EmailRenderer.Service</code> and <code>Postman.Service</code> is expressed as abstract value, forcing the programmer to provide
instances of these services when constructing the environment. Note that <code>Newsletter</code> <em>module</em> does not depend on anything. Only <code>NewsletterLive</code>
implementation depends on those. This allows you to create other implementations with different (or zero) dependencies, like a helper object to access
service effects:</p>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">Helper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Newsletter</span>.<span class="hljs-title">Service</span>[<span class="hljs-type">Newsletter</span>] </span>{

  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">send</span></span>(id: <span class="hljs-type">TemplateId</span>, recipients: <span class="hljs-type">List</span>[<span class="hljs-type">EmailAddress</span>]) =
    <span class="hljs-type">ZIO</span>.accessM(_.newsletter.send(id, recipients))
}
</code></pre>
<blockquote>
<p><strong>Note:</strong> by convention such a helper would be defined inside module's companion object and named <code>&gt;</code>.
This is to have a nice syntax to access effects like <code>Newsletter.&gt;.send(id, recipients)</code>.
You can use the <code>@accessible</code> macro from <a href="https://github.com/zio/zio-macros">zio-macros</a> to derive this boilerplate code automatically.</p>
</blockquote>
<p>Should you need to create a test implementation it will most likely have different dependencies (or none at all).</p>
<h2><a class="anchor" aria-hidden="true" id="advantages-using-module-pattern"></a><a href="#advantages-using-module-pattern" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Advantages using module pattern</h2>
<p>First and foremost, the dependencies defined using the <em>module pattern</em> are <strong>checked at compile time</strong>. If you fail to provide the required dependency
you will get a <strong>readable and accurate compiler error</strong>:</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> result =
  <span class="hljs-type">Helper</span>
    .send(id, recipients)
    .provide(<span class="hljs-keyword">new</span> <span class="hljs-type">NewsletterLive</span> {})
</code></pre>
<pre><code class="hljs"><span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">creation</span> <span class="hljs-title">impossible</span>, <span class="hljs-title">since</span></span>:
it has <span class="hljs-number">2</span> unimplemented members.
<span class="hljs-comment">/** As seen from NewsletterLive, the missing signatures are as follows.
 *  For convenience, these are usable as stub implementations.
 */</span>
  <span class="hljs-keyword">val</span> emailRenderer: <span class="hljs-type">EmailRenderer</span>.<span class="hljs-type">Service</span>[<span class="hljs-type">Any</span>] = ???
  <span class="hljs-keyword">val</span> postman: <span class="hljs-type">Postman</span>.<span class="hljs-type">Service</span>[<span class="hljs-type">Any</span>] = ???

    .provide(<span class="hljs-keyword">new</span> <span class="hljs-type">NewsletterLive</span> {})
                 ^^^^^^^^^^^^^^^^^
</code></pre>
<p>The compiler error clearly states what is missing and where. As a counterexample, let's see would happen had we used the cake pattern:</p>
<pre><code class="hljs css language-scala"><span class="hljs-class"><span class="hljs-keyword">trait</span> <span class="hljs-title">NewsletterLiveCake</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Newsletter</span> </span>{ self: <span class="hljs-type">EmailRenderer</span> <span class="hljs-keyword">with</span> <span class="hljs-type">Postman</span> =&gt;
  <span class="hljs-comment">/* ... */</span>
}

<span class="hljs-keyword">val</span> result2 = app.provide(<span class="hljs-keyword">new</span> <span class="hljs-type">NewsletterLiveCake</span> {})
</code></pre>
<p>The compiler error contains a trainwreck of interfaces. This case is still relatively simple, but as your application grows this quickly explodes
and becomes completely unreadable.</p>
<pre><code class="hljs">illegal inheritance;
 self-<span class="hljs-class"><span class="hljs-keyword">type</span> <span class="hljs-title">NewsletterLiveCake</span> <span class="hljs-title">does</span> <span class="hljs-title">not</span> <span class="hljs-title">conform</span> <span class="hljs-title">to</span> <span class="hljs-title">NewsletterLiveCake</span>'<span class="hljs-title">s</span> <span class="hljs-title">selftype</span> <span class="hljs-title">NewsletterLiveCake</span> <span class="hljs-keyword">with</span> <span class="hljs-title">EmailRenderer</span> <span class="hljs-keyword">with</span> <span class="hljs-title">Postman</span></span>
<span class="hljs-keyword">val</span> result2 = app.provide(<span class="hljs-keyword">new</span> <span class="hljs-type">NewsletterLiveCake</span> {})
                              ^^^^^^^^^^^^^^^^^^
</code></pre>
<p>Secondly, the dependencies are <strong>order-insensitive</strong>, meaning, you may provide the actual modules in any order you like.</p>
<pre><code class="hljs css language-scala"><span class="hljs-keyword">val</span> app = <span class="hljs-type">Helper</span>.send(id, recipients)

<span class="hljs-keyword">val</span> result3 = app.provide(<span class="hljs-keyword">new</span> <span class="hljs-type">EmailRendererLive</span> <span class="hljs-keyword">with</span> <span class="hljs-type">PostmanLive</span> <span class="hljs-keyword">with</span> <span class="hljs-type">NewsletterLive</span> {})
<span class="hljs-comment">// or</span>
<span class="hljs-keyword">val</span> result4 = app.provide(<span class="hljs-keyword">new</span> <span class="hljs-type">PostmanLive</span> <span class="hljs-keyword">with</span> <span class="hljs-type">NewsletterLive</span> <span class="hljs-keyword">with</span> <span class="hljs-type">EmailRendererLive</span> {})
</code></pre>
<p>Another benefit is that this approach <strong>allows for circular dependencies</strong> between services. The environment is a single object with all the modules
mixed in. It cannot be used until it's initialized and once it is, all of the services are ready to be used, in any order you wish.</p>
<p>Finally, the machinery behind <em>module pattern</em> is plain Scala code. There is <strong>no magic behind the scenes</strong>. The programmer is in full control and can
rely on the compiler to indicate which environment is required to provide in order to run the program.</p>
<h2><a class="anchor" aria-hidden="true" id="next-steps"></a><a href="#next-steps" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Next Steps</h2>
<p>Depending on the role <em>service</em> plays in the application, you may need to either assert on values returned by <em>capacities</em> or set expectations on
<em>calls</em> to the collaborating service. Luckily both approaches are very simple.</p>
<p>First learn how to <a href="/docs/howto/howto_test_effects">test effects</a> and once you are comfortable with testing effects, then the next step is to learn how to
<a href="/docs/howto/howto_mock_services">mock services</a>.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/howto/howto_index"><span class="arrow-prev">← </span><span>Summary</span></a><a class="docs-next button" href="/docs/howto/howto_test_effects"><span>Test effects</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#how-to-structure-larger-zio-programs">How to structure larger ZIO programs?</a></li><li><a href="#hidden-inputs">Hidden inputs</a></li><li><a href="#environmental-effects">Environmental effects</a></li><li><a href="#module-pattern">Module pattern</a></li><li><a href="#dependency-injection">Dependency injection</a></li><li><a href="#advantages-using-module-pattern">Advantages using module pattern</a></li><li><a href="#next-steps">Next Steps</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"><img src="/img/navbar_brand.png" alt="ZIO"/></a><div><h5>GitHub</h5><a href="https://github.com/zio/zio"><img src="https://img.shields.io/github/stars/zio/zio?style=social" alt="github"/></a></div><div><h5>Chat with us on Discord</h5><a href="https://discord.gg/2ccFBr4"><img src="https://img.shields.io/discord/629491597070827530?logo=discord&amp;style=social" alt="discord"/></a></div><div><h5>Follow us on Twitter</h5><a href="https://twitter.com/zioscala"><img src="https://img.shields.io/twitter/follow/zioscala?label=Follow&amp;style=social" alt="twitter"/></a></div><div><h5>Additional resources</h5><a href="https://javadoc.io/doc/dev.zio/zio_2.12/">Scaladoc of zio</a></div></section><section class="copyright">Copyright © 2020 ZIO Maintainers</section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '0c94b59071da7001757d08ab43d9e033',
                indexName: 'zio',
                inputSelector: '#search_input_react',
                algoliaOptions: {}
              });
            </script></body></html>